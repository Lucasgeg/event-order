generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Tenant {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categories Category[]
  products   Product[]
  orders     Order[]
  members    TenantMember[]
}

model TenantMember {
  id       String @id @default(cuid())
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId String

  userId String // Clerk user id
  role   TenantRole

  @@unique([tenantId, userId])
}

enum TenantRole {
  ADMIN
  USER
}

model Category {
  id            String        @id @default(cuid())
  name          String
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId      String
  subCategories SubCategory[]
  products      Product[]
}

model SubCategory {
  id         String    @id @default(cuid())
  name       String
  category   Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId String
  products   Product[]
}

model Product {
  id            String       @id @default(cuid())
  designation   String
  price         Float
  category      Category     @relation(fields: [categoryId], references: [id])
  categoryId    String
  subCategory   SubCategory? @relation(fields: [subCategoryId], references: [id])
  subCategoryId String?
  orderItems    OrderItem[]
  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId      String
}

model Order {
  id         String      @id @default(cuid())
  clientName String
  pickupDate DateTime
  createdAt  DateTime    @default(now())
  items      OrderItem[]
  tenant     Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId   String
}

model OrderItem {
  id        String  @id @default(cuid())
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId   String
  product   Product @relation(fields: [productId], references: [id])
  productId String
  quantity  Int
}
